<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Authorize</title>
</head>

<body>
    <h1>Public Client Sample</h1>
    <button id="startButton">Start OAuth Flow</button>
    <div id="result"></div>
    <script type="module">
        import { PKCE } from './pkce.js';
        const pkce = new PKCE("http://idp.byo.one/auth/realms/byoone")
        
        if (window.location.search) {
            var args = new URLSearchParams(window.location.search);
            var code = args.get("code");
            if (code) {
                this.auth_code_tokens(code).then(response => {
                    response.json().then(t => {
                        let message = `
                            <ul>
                                <li>access token: <a href="https://jwt.io?token=${t.access_token}">${t.access_token}</a></li>
                                <li>refresh token:  <a href="https://jwt.io?token=${t.refresh_token}">${t.refresh_token}</a></li>
                                <li>id token:  <a href="https://jwt.io?token=${t.id_token}">${t.id_token}</a></li>
                            </ul>
                        `;
                        document.getElementById("result").innerHTML = message
                    });
                })
                .catch(error => {
                    let message = "Error: " + error;
                    document.getElementById("result").innerHTML = message;
                    location.search = null;
                });
            }
        }

        document.getElementById("startButton").onclick = function () {
            pkce.authorize()
        }
    </script>
</body>

</html>